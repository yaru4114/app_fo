<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bid.fo.main.dao.BidMainDAO">
	<select id="selectBidList" parameterType="com.bid.fo.main.model.MainVO" resultType="com.bid.fo.main.model.MainVO">
		SELECT BID_PBLANC_ID			/* 입찰 공고 아이디 */
			 , METAL_CODE				/* 금속 코드 */	
			 , ISNULL((SELECT CODE_NM FROM CO_CMMN_CD WHERE MAIN_CODE = 'BRAND_GROUP_CODE' AND SUB_CODE = BBB.BRAND_GROUP_CODE),'브랜드 무관') AS BRAND_GROUP_CODE_NM
			 , (SELECT CODE_NM FROM CO_CMMN_CD WHERE MAIN_CODE = 'DSTRCT_LCLSF_CODE' AND SUB_CODE = BBB.DSTRCT_LCLSF_CODE) AS DSTRCT_LCLSF_CODE_NM
			 , BRAND_CODE				/* 브랜드 코드 */
			 , (SELECT ITM_PRDLST_ENG FROM IT_ITM_INFO_BAS WHERE ITM_SN = BBB.ITM_SN) AS DSPY_GOODS_NM
			 , BID_WT					/* 입찰 중량 */
			 , BDDPR_BEGIN_DT 			/* 투찰 시작 일시 */
			 , BDDPR_END_DT 				/* 투찰 종료 일시 */
			 , BID_STTUS_CODE			/* 입찰 상태 코드 */
			 , ISNULL(PARTCPTN_ENTRPS_QY,0)	AS PARTCPTN_ENTRPS_QY	/* 참여 업체 수량 */
			 , ISNULL(INTRST_ENTRPS_QY,0)	AS INTRST_ENTRPS_QY			/* 관심 업체 수량 */
			 , DSPY_AT					/* 전시 여부 */
		  FROM dbo.BD_BID_BAS BBB			/* 입찰_입찰 기본 */
		  WHERE 1=1
		  	AND DSPY_AT = 'Y'
		    <if test="filter == '01'">
				<if test="startDate != null and startDate != ''" >
					AND BDDPR_BEGIN_DT > #{startDate} + '000000'
				</if>
				<if test="endDate != null and endDate != ''" >
					AND BDDPR_BEGIN_DT  <![CDATA[<]]> #{endDate} + '235959' 
				</if> 
			</if>
			<if test="filter == '02'">
				<if test="startDate != null and startDate != ''" >
					AND BDDPR_END_DT > #{startDate} + '000000'
				</if>
				<if test="endDate != null and endDate != ''" >
					AND BDDPR_END_DT  <![CDATA[<]]> #{endDate} + '235959' 
				</if>
			</if>
			<if test="bidSttusCode != null and bidSttusCode != ''">
				<if test="bidSttusCode =='12' or bidSttusCode =='13'">
					AND BID_STTUS_CODE = #{bidSttusCode}
				</if>
				<if test="bidSttusCode =='30'">
					AND BID_STTUS_CODE IN ('31','32')
				</if>
			</if>
			<if test="brandGroupCode != null and brandGroupCode != ''">
				AND BRAND_GROUP_CODE = #{brandGroupCode}
			</if>
			<if test="dstrctLclsfCode != null and dstrctLclsfCode != ''">
				AND DSTRCT_LCLSF_CODE = #{dstrctLclsfCode}
			</if>
	</select>
	<select id="selectBidListCnt" parameterType="com.bid.fo.main.model.MainVO" resultType="com.bid.fo.main.model.MainVO">
		SELECT BID_STTUS_CODE
			 , COUNT(BID_PBLANC_ID)	AS BID_STTUS_CNT   /* 입찰상태코드별 개수 */
		  FROM dbo.BD_BID_BAS			/* 입찰_입찰 기본 */
		  WHERE 1=1
		    AND DSPY_AT = 'Y'
		    <if test="filter == '01'">
				<if test="startDate != null and startDate != ''" >
					AND BDDPR_BEGIN_DT > #{startDate} + '000000'
				</if>
				<if test="endDate != null and endDate != ''" >
					AND BDDPR_BEGIN_DT  <![CDATA[<]]> #{endDate} + '235959' 
				</if> 
			</if>
			<if test="filter == '02'">
				<if test="startDate != null and startDate != ''" >
					AND BDDPR_END_DT > #{startDate} + '000000' 
				</if>
				<if test="endDate != null and endDate != ''" >
					AND BDDPR_END_DT  <![CDATA[<]]> #{endDate} + '235959' 
				</if>
			</if>
			<if test="brandGroupCode != null and brandGroupCode != ''">
				AND BRAND_GROUP_CODE = #{brandGroupCode}
			</if>
			<if test="dstrctLclsfCode != null and dstrctLclsfCode != ''">
				AND DSTRCT_LCLSF_CODE = #{dstrctLclsfCode}
			</if>
			GROUP BY BID_STTUS_CODE
	</select>
	<select id="selectBidTabCnt" parameterType="com.bid.fo.main.model.MainVO" resultType="com.bid.fo.main.model.MainVO">
		SELECT SUM(BBB.EXCEPT_CNT) AS EXCEPT_CNT
	 		 , SUM(BBB.BDDPR_CNT) AS BDDPR_CNT
		 	 , SUM(BBB.END_CNT) AS END_CNT
		  FROM (SELECT CASE WHEN BID_STTUS_CODE = '12' THEN 1 ELSE 0 END AS EXCEPT_CNT
				 	 ,CASE WHEN BID_STTUS_CODE = '13' THEN 1 ELSE 0 END AS BDDPR_CNT
				 	 ,CASE WHEN BID_STTUS_CODE = '30' THEN 1 ELSE 0 END AS END_CNT
				  FROM dbo.BD_BID_BAS) AS BBB
	</select>
</mapper>