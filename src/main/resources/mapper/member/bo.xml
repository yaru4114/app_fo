<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bid.bo.member.dao.BdMemberDAO" >
    <select id="getMemberList" parameterType="com.bid.common.model.PagingVO" resultType="com.bid.common.model.BidMemberVO">
        SELECT
            ROW_NUMBER() OVER (ORDER BY (SELECT 1)) AS rowNo,
            ENTRPS_NM,
            BID_MBER_ID,
            BSNM_REGIST_NO,
            BID_MBER_EMAIL,
            MOBLPHON_NO2,
            FRNTN_ENTRPS_AT,
            ETR_CONFM_REQUST_DT,
            ETR_CONFM_PROCESS_DT,
            BID_MBER_INTRCP_DT,
            (CASE
                WHEN BID_MBER_STTUS_CODE = '01' THEN '정상'
                WHEN BID_MBER_STTUS_CODE = '02' THEN '차단'
                ELSE ''
            END) AS BID_MBER_STTUS_CODE,
            (
                SELECT COUNT(*)
                FROM BD_BDDPR_DTL a
                INNER JOIN BD_SCSBID_DTL b ON a.BID_PBLANC_ID = b.BID_PBLANC_ID
                WHERE a.SCSBID_AT = 'Y'
                AND a.BID_ENTRPS_NO = BD_ENTRPS_INFO_BAS.BID_ENTRPS_NO
                AND b.JDGMN_STTUS_CODE = '40'
            ) AS SCSBID_CNT,
            (
                SELECT COUNT(*)
                FROM BD_BDDPR_DTL
                WHERE SCSBID_AT = 'N'
                AND BID_ENTRPS_NO = BD_ENTRPS_INFO_BAS.BID_ENTRPS_NO
            ) AS NON_SCSBID_CNT
        FROM BD_ENTRPS_INFO_BAS
        WHERE
            1 = 1
        <if test="status != null and status != '' and status != '03'">
            <choose>
                <when test="status == '00'">
                    AND (BID_MBER_STTUS_CODE = '01' OR BID_MBER_STTUS_CODE = '02')
                </when>
                <otherwise>
                    AND BID_MBER_STTUS_CODE = #{status}
                </otherwise>
            </choose>
        </if>
        <if test="searchType eq '회사명'">
            AND ENTRPS_NM LIKE '%' + #{searchKeyword} + '%'
        </if>
        <if test="searchType eq 'ID'">
            AND BID_MBER_ID LIKE '%' + #{searchKeyword} + '%'
        </if>
        <if test="searchType eq '전체'">
            AND (
                (ENTRPS_NM LIKE '%' + #{searchKeyword} + '%')
                OR (BID_MBER_ID LIKE '%' + #{searchKeyword} + '%')
            )
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            AND ETR_CONFM_REQUST_DT BETWEEN #{startDate} AND #{endDate}
        </if>
        ORDER BY BID_ENTRPS_NO DESC, rowNo ASC
    </select>

    <select id="getMemberCnt" parameterType="com.bid.common.model.PagingVO" resultType="int">
        SELECT COUNT(*)
        FROM BD_ENTRPS_INFO_BAS
        WHERE
        1 = 1
        <if test="status != null and status != '' and status != '03'">
            <choose>
                <when test="status == '00'">
                    AND (BID_MBER_STTUS_CODE = '01' OR BID_MBER_STTUS_CODE = '02')
                </when>
                <otherwise>
                    AND BID_MBER_STTUS_CODE = #{status}
                </otherwise>
            </choose>
        </if>
        <if test="searchType eq '회사명'">
            AND ENTRPS_NM LIKE '%' + #{searchKeyword} + '%'
        </if>
        <if test="searchType eq 'ID'">
            AND BID_MBER_ID LIKE '%' + #{searchKeyword} + '%'
        </if>
        <if test="searchType eq '전체'">
            AND (
            (ENTRPS_NM LIKE '%' + #{searchKeyword} + '%')
            OR (BID_MBER_ID LIKE '%' + #{searchKeyword} + '%')
            )
        </if>
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            AND ETR_CONFM_REQUST_DT BETWEEN #{startDate} AND #{endDate}
        </if>
    </select>

    <select id="test" resultType="com.bid.common.model.BidMemberVO">
        SELECT BID_ENTRPS_NO FROM BD_ENTRPS_INFO_BAS
    </select>
</mapper>